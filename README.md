# NextJS + PostgreSQL + WebSocket + SonarQube

Un projet Next.js moderne avec int√©gration PostgreSQL, WebSocket et analyse de code SonarQube.

## Technologies utilis√©es

- **Next.js 15.3.2** avec React 19
- **TypeScript** pour la s√©curit√© des types
- **PostgreSQL** pour la base de donn√©es
- **Docker & Docker Compose** pour la containerisation
- **SonarQube/SonarCloud** pour l'analyse de qualit√© du code
- **Tailwind CSS** pour le styling

## D√©marrage rapide

### Avec Docker (Recommand√©)

```bash
# D√©marrer tous les services
docker-compose up -d

# Acc√®s aux services :
# - Application Next.js : http://localhost:3001
# - PostgreSQL : localhost:3002
# - pgAdmin : http://localhost:3003
# - SonarQube : http://localhost:3004
```

### D√©veloppement local

```bash
# Installer les d√©pendances
npm install

# D√©marrer le serveur de d√©veloppement
npm run dev
```

Ouvrez [http://localhost:3000](http://localhost:3000) dans votre navigateur.

## Environment Variables

This project uses environment variables for configuration.

### Local Development

1.  **Create a local environment file:**
    Copy the example environment file `.env.local.example` to a new file named `.env.local`:
    ```bash
    cp .env.local.example .env.local
    ```
    The `.env.local` file is included in `.gitignore` and should not be committed to the repository.

2.  **Set your variables:**
    Open `.env.local` and update the placeholder values with your actual configuration details for:
    *   PostgreSQL database credentials (`POSTGRES_USER`, `POSTGRES_PASSWORD`, `POSTGRES_DB`)
    *   pgAdmin credentials (`PGADMIN_DEFAULT_EMAIL`, `PGADMIN_DEFAULT_PASSWORD`)
    *   SonarQube token (`SONAR_TOKEN`), if needed for local scanning via `docker-compose`.
    *   Application-specific variables like `NEXT_PUBLIC_APP_NAME`.

    These variables will be automatically loaded when you run `docker-compose up` or `npm run dev`.

### Environment Variables in Next.js

*   **Client-side (Browser):** To expose a variable to the browser, prefix it with `NEXT_PUBLIC_` (e.g., `NEXT_PUBLIC_APP_NAME`). These are embedded at build time.
*   **Server-side:** Variables without the `NEXT_PUBLIC_` prefix are available only on the server-side (e.g., in API routes, or if using `getServerSideProps`). You can access them via `process.env.YOUR_VARIABLE_NAME`.

Refer to the [Next.js documentation on Environment Variables](https://nextjs.org/docs/app/building-your-application/configuring/environment-variables) for more details.

### CI/CD and Production

*   **CI/CD (GitHub Actions):** Environment variables (especially secrets like API keys, `SONAR_TOKEN`) are typically configured as "Secrets" in the GitHub repository settings. The CI workflows (`.github/workflows/`) are set up to use these secrets.
*   **Production Deployments (e.g., Vercel, Docker container on a server):** You will need to set these environment variables in your hosting provider's settings or your server environment. Consult your deployment platform's documentation for the correct way to set them.

## Code Optimization and Performance

While the current application is a starter template, here are some common Next.js optimization strategies to keep in mind as your project grows:

*   **Image Optimization:**
    *   Use the `next/image` component for automatic image optimization (already used in the starter). It handles resizing, optimizing formats (like WebP), and lazy loading.

*   **Dynamic Imports (`next/dynamic`):**
    *   Load components or libraries only when they are needed, not upfront. This is especially useful for large components or libraries that are not critical for the initial page load.
    *   Example: `const MyComponent = dynamic(() => import('../components/MyComponent'))`

*   **Code Splitting:**
    *   Next.js automatically does code splitting by page. You can further optimize by strategically organizing your components and using dynamic imports.

*   **Server Components and Client Components:**
    *   Understand the difference and use them appropriately in the App Router. Keep client-side JavaScript ‡§™‡•Å‡§≤‡§ø‡§∏ ‡§∏‡§ï‡•á‡§∏‡§Æ‡•ç‡§ÆÂ∞ë„Å™„Åè (as minimal as possible) by leveraging Server Components for UI that doesn't need interactivity or browser APIs.
    *   Fetch data in Server Components where possible.

*   **Bundle Analysis:**
    *   Use tools like `@next/bundle-analyzer` to inspect the JavaScript bundles generated by your application. This can help identify large dependencies or custom code that could be optimized.

*   **Memoization:**
    *   For expensive computations in React components, use `React.memo` for functional components or `shouldComponentUpdate` / `PureComponent` for class components to prevent unnecessary re-renders.
    *   Use `useMemo` and `useCallback` hooks to memoize values and functions within your components.

*   **API Route Optimization:**
    *   If you build API routes, ensure they are efficient. Cache responses where appropriate, optimize database queries, and handle requests asynchronously.

*   **Efficient State Management:**
    *   Choose a state management solution that fits your application's complexity (Context API, Zustand, Redux, etc.) and use it efficiently to avoid excessive re-renders.

*   **Linting and Code Quality:**
    *   Continue using linters (like ESLint, already set up) and code formatters (like Prettier) to maintain code quality, which indirectly contributes to performance by making code easier to reason about and refactor.

*   **Keep Dependencies Updated:**
    *   Regularly update your dependencies (Next.js, React, etc.) as new versions often include performance improvements and bug fixes.

Refer to the [Next.js documentation on Performance](https://nextjs.org/docs/app/building-your-application/optimizing) for more in-depth guidance.

## Configuration SonarQube

### SonarQube auto-h√©berg√©

Le projet est configur√© avec **SonarQube** pour l'analyse automatique sur GitHub Actions.

üìã **Guide de d√©pannage** : Consultez [SONARQUBE_SETUP.md](./SONARQUBE_SETUP.md) pour r√©soudre les probl√®mes d'autorisation.

#### Configuration des secrets GitHub

Configurez ces secrets dans votre repository GitHub (**Settings** ‚Üí **Secrets and variables** ‚Üí **Actions**) :

- **`SONAR_TOKEN`** : Token d'authentification SonarQube
- **`SONAR_HOST_URL`** : `http://168.231.87.2:3004`

#### Configuration SonarQube local

1. **D√©marrez SonarQube** avec Docker :
   ```bash
   docker-compose up sonarqube
   ```

2. **Acc√©dez √† SonarQube** : http://168.231.87.2:3004

3. **Connectez-vous** (admin/admin par d√©faut)

4. **Cr√©ez le projet** :
   - Nom : `NEXTJS-POSTGRES-WEBSOCKET-SONARQUBE`
   - Cl√© : `NEXTJS-POSTGRES-WEBSOCKET-SONARQUBE`

5. **G√©n√©rez un token** :
   - **Administration** ‚Üí **Security** ‚Üí **Users**
   - Cliquez sur votre utilisateur ‚Üí **Tokens**
   - G√©n√©rez un nouveau token

6. **Testez la connexion** (optionnel) :
   ```bash
   bash test-sonar-token.sh http://168.231.87.2:3004 YOUR_TOKEN
   ```

#### GitHub Actions

Le workflow `build.yml` s'ex√©cute automatiquement et utilise votre instance SonarQube.

## Scripts disponibles

```bash
npm run dev      # Serveur de d√©veloppement avec Turbopack
npm run build    # Build de production
npm run start    # Serveur de production
npm run lint     # V√©rification ESLint
```

## Workflows disponibles

- **`build.yml`** : Analyse avec SonarQube auto-h√©berg√©

## Structure du projet

```
‚îú‚îÄ‚îÄ app/                 # Pages et composants Next.js (App Router)
‚îú‚îÄ‚îÄ public/             # Fichiers statiques
‚îú‚îÄ‚îÄ .github/workflows/  # Workflows GitHub Actions
‚îú‚îÄ‚îÄ docker-compose.yml  # Configuration Docker
‚îú‚îÄ‚îÄ sonar-project.properties  # Configuration SonarQube/SonarCloud
‚îî‚îÄ‚îÄ package.json       # D√©pendances et scripts
```

## D√©ploiement

Le moyen le plus simple de d√©ployer votre application Next.js est d'utiliser la [plateforme Vercel](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme).

Consultez la [documentation de d√©ploiement Next.js](https://nextjs.org/docs/app/building-your-application/deploying) pour plus de d√©tails.
